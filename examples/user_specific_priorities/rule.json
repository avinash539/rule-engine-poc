{
    "contentType": "application/vnd.gorules.decision",
    "nodes": [
        {
            "id": "input-node",
            "type": "inputNode",
            "position": {
                "x": 100,
                "y": 100
            },
            "name": "Request"
        },
        {
            "id": "decision-table-node",
            "type": "decisionTableNode",
            "position": {
                "x": 400,
                "y": 100
            },
            "name": "Get User Priorities",
            "content": {
                "hitPolicy": "first",
                "inputs": [
                    {
                        "id": "input-user",
                        "name": "User ID",
                        "field": "user_id",
                        "type": "expression"
                    }
                ],
                "outputs": [
                    {
                        "id": "output-priorities",
                        "name": "Priority List",
                        "field": "priority_list",
                        "type": "expression"
                    }
                ],
                "rules": [
                    {
                        "_id": "rule-1",
                        "input-user": "user_id == 'user_1'",
                        "output-priorities": "['Shreemaruti', 'DHL', 'India Post']"
                    },
                    {
                        "_id": "rule-2",
                        "input-user": "user_id == 'user_2'",
                        "output-priorities": "['DHL', 'India Post', 'Shreemaruti']"
                    },
                    {
                        "_id": "rule-3",
                        "input-user": "user_id == 'user_3'",
                        "output-priorities": "['India Post', 'Shreemaruti', 'DHL']"
                    },
                    {
                        "_id": "rule-fallback",
                        "input-user": "",
                        "output-priorities": "[]"
                    }
                ]
            }
        },
        {
            "id": "function-node",
            "type": "functionNode",
            "position": {
                "x": 700,
                "y": 100
            },
            "name": "Select Best Partner",
            "content": "const handler = (input) => {\n  console.log('Function Input:', JSON.stringify(input));\n  const priorities = input.priority_list || [];\n  const partners = input.partners || [];\n\n  // Filter serviceable partners\n  const serviceableMap = {};\n  partners.forEach(p => {\n    if (p.is_serviceable) {\n      serviceableMap[p.partner_code] = p;\n    }\n  });\n\n  // Find first priority that is serviceable\n  let selected = null;\n  let reason = 'No suitable partner found';\n\n  for (const code of priorities) {\n    if (serviceableMap[code]) {\n      selected = code;\n      reason = 'Selected based on user priority: ' + code;\n      break;\n    }\n  }\n\n  return {\n    selected_partner: selected,\n    reason: reason\n  };\n}"
        },
        {
            "id": "output-node",
            "type": "outputNode",
            "position": {
                "x": 1000,
                "y": 100
            },
            "name": "Response"
        }
    ],
    "edges": [
        {
            "id": "edge-1",
            "sourceId": "input-node",
            "targetId": "decision-table-node",
            "type": "edge"
        },
        {
            "id": "edge-2",
            "sourceId": "decision-table-node",
            "targetId": "function-node",
            "type": "edge"
        },
        {
            "id": "edge-input-func",
            "sourceId": "input-node",
            "targetId": "function-node",
            "type": "edge"
        },
        {
            "id": "edge-3",
            "sourceId": "function-node",
            "targetId": "output-node",
            "type": "edge"
        }
    ]
}